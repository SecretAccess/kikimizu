<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>利き水チャレンジ</title>
    <!-- Sortable.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <style>
        /* CSSのスタイル */

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            margin: 0;
            padding: 0;
        }

        #game-container {
            padding: 20px;
        }

        .stage {
            display: none;
        }

        .water-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .water-grid label {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100px;
            cursor: pointer;
        }

        .water-grid img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border: 2px solid #ccc;
            border-radius: 8px;
            transition: border 0.3s;
        }

        .water-grid input[type="checkbox"],
        .water-grid input[type="radio"] {
            display: none;
        }

        .water-grid input[type="checkbox"]:checked + img,
        .water-grid input[type="radio"]:checked + img {
            border-color: #00ced1;
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #00ced1;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #20b2aa;
        }

        .error {
            color: red;
            margin-top: 10px;
        }

        #order-list {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }

        #order-list li {
            padding: 10px;
            margin: 5px 0;
            background-color: #e0ffff;
            border: 1px solid #00ced1;
            border-radius: 5px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #order-list li img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }

        #result-message {
            font-size: 18px;
            margin-top: 20px;
        }

        /* レスポンシブデザイン */
        @media (max-width: 600px) {
            .water-grid label {
                width: 80px;
            }

            .water-grid img {
                width: 60px;
                height: 60px;
            }

            button {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- ステージ1: 水の選択 -->
        <div id="stage-1" class="stage" style="display:block;">
            <h2>水の種類を選択してください</h2>
            <div id="water-selection" class="water-grid">
                <label>
                    <input type="checkbox" value="天然水">
                    <img src="tennensui.png" alt="天然水">
                    天然水
                </label>
                <label>
                    <input type="checkbox" value="いろはす">
                    <img src="irohasu.png" alt="いろはす">
                    いろはす
                </label>
                <label>
                    <input type="checkbox" value="クリスタルガイザー">
                    <img src="crystal.png" alt="クリスタルガイザー">
                    クリスタルガイザー
                </label>
                <label>
                    <input type="checkbox" value="エビアン">
                    <img src="ebian.png" alt="エビアン">
                    エビアン
                </label>
                <label>
                    <input type="checkbox" value="富士山水">
                    <img src="fujisansui.png" alt="富士山水">
                    富士山水
                </label>
                <label>
                    <input type="checkbox" value="おいしい水">
                    <img src="oisiimizu.png" alt="おいしい水">
                    おいしい水
                </label>
                <label>
                    <input type="checkbox" value="アルカリ天然水">
                    <img src="premiere.png" alt="アルカリ天然水">
                    アルカリ天然水(7＆iPB)
                </label>
              <label>
                    <input type="checkbox" value="ウォーターサーバー">
                    <img src="server.png" alt="ウォーターサーバー">
                   ウォーターサーバー
                </label>
            </div>
            <button id="next-to-order">次へ</button>
            <p id="error-message" class="error"></p>
        </div>

        <!-- ステージ2: 提供順序の入れ替え -->
        <div id="stage-2" class="stage">
            <h2>提供する順番に並び替えてください</h2>
            <ul id="order-list">
                <!-- 選択した水がここに表示される -->
            </ul>
            <button id="confirm-order">確認</button>
        </div>

        <!-- ステージ3: プレイヤーの操作 -->
        <div id="stage-3" class="stage">
            <h2>プレイヤーが操作してください</h2>
            <p id="cup-instruction">1杯目を選んでください</p>
            <div id="player-selection" class="water-grid">
                <!-- プレイヤーが選択する水がここに表示される -->
            </div>
        </div>

        <!-- ステージ4: 結果表示 -->
        <div id="stage-4" class="stage">
            <h2>結果</h2>
            <p id="result-message"></p>
            <button onclick="location.reload()">リセット</button>
        </div>
    </div>

    <script>
        // JavaScriptのロジック

        let selectedWaters = [];
        let dealerOrder = [];
        let playerGuesses = [];
        let correctCount = 0;
        let currentCup = 1;

        // ステージの要素を取得
        const stage1 = document.getElementById('stage-1');
        const stage2 = document.getElementById('stage-2');
        const stage3 = document.getElementById('stage-3');
        const stage4 = document.getElementById('stage-4');

        // エラー表示
        const errorMessage = document.getElementById('error-message');

        // 次へボタンのイベントリスナー
        document.getElementById('next-to-order').addEventListener('click', () => {
            // 選択された水を取得
            const checkboxes = document.querySelectorAll('#water-selection input[type="checkbox"]:checked');
            if (checkboxes.length <= 1) {
                errorMessage.textContent = '2つ以上の水を選択してください。';
                return;
            }
            errorMessage.textContent = '';
            selectedWaters = Array.from(checkboxes).map(cb => cb.value);
            // ステージ1を隠してステージ2を表示
            stage1.style.display = 'none';
            stage2.style.display = 'block';
            initializeOrderList();
        });

        // 順序入れ替えリストの初期化
        function initializeOrderList() {
            const orderList = document.getElementById('order-list');
            orderList.innerHTML = '';
            selectedWaters.forEach(water => {
                const li = document.createElement('li');
                li.setAttribute('data-value', water);
                li.innerHTML = `<img src="${getImageFile(water)}" alt="${water}">${water}`;
                orderList.appendChild(li);
            });
            // Sortable.jsを初期化
            Sortable.create(orderList, {
                animation: 150
            });
        }

        // 確認ボタンのイベントリスナー
        document.getElementById('confirm-order').addEventListener('click', () => {
            const orderItems = document.querySelectorAll('#order-list li');
            dealerOrder = Array.from(orderItems).map(item => item.getAttribute('data-value'));
            // ステージ2を隠してステージ3を表示
            stage2.style.display = 'none';
            stage3.style.display = 'block';
            initializePlayerSelection();
        });

        // プレイヤー選択の初期化
        function initializePlayerSelection() {
            const playerSelection = document.getElementById('player-selection');
            playerSelection.innerHTML = '';
            selectedWaters.forEach(water => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="radio" name="player-choice" value="${water}">
                    <img src="${getImageFile(water)}" alt="${water}">
                    ${water}
                `;
                playerSelection.appendChild(label);
            });
        }

        // プレイヤーが水を選択したときの処理
        document.getElementById('player-selection').addEventListener('change', (e) => {
            if (e.target && e.target.name === 'player-choice') {
                const selectedWater = e.target.value;
                playerGuesses.push(selectedWater);
                // ディーラーが実際に提供する水を表示
                showDealerChoice(currentCup, dealerOrder[currentCup - 1]);
                currentCup++;
                // 次の杯へ
                if (currentCup > dealerOrder.length) {
                    // ゲーム終了
                    showResults();
                } else {
                    document.getElementById('cup-instruction').textContent = `${currentCup}杯目を選んでください`;
                    // 選択をリセット
                    document.querySelectorAll('input[name="player-choice"]').forEach(cb => cb.checked = false);
                }
            }
        });

        // ディーラーの選択を表示
        function showDealerChoice(cupNumber, water) {
            // 画像と名前を表示する要素を動的に作成
            const instruction = document.getElementById('cup-instruction');
            const dealerInfo = document.createElement('div');
            dealerInfo.style.marginTop = '10px';
            dealerInfo.innerHTML = `
                <p>${cupNumber}杯目は <strong>${water}</strong> です。</p>
                <img src="${getImageFile(water)}" alt="${water}" style="width:60px;height:60px;">
            `;
            instruction.parentNode.insertBefore(dealerInfo, instruction.nextSibling);
        }

        // 結果を表示
        function showResults() {
            stage3.style.display = 'none';
            stage4.style.display = 'block';
            // 正解数を計算
            correctCount = playerGuesses.filter((guess, index) => guess === dealerOrder[index]).length;
            const accuracy = ((correctCount / dealerOrder.length) * 100).toFixed(2);
            document.getElementById('result-message').textContent = `${correctCount}問正解　正解率 ${accuracy}%`;
        }

        // 画像ファイルを取得
        function getImageFile(water) {
            switch(water) {
                case '天然水': return 'tennensui.png';
                case 'いろはす': return 'irohasu.png';
                case 'クリスタルガイザー': return 'crystal.png';
                case 'エビアン': return 'ebian.png';
                case '富士山水': return 'fujisansui.png';
                case 'おいしい水': return 'oisiimizu.png';
                case 'アルカリ天然水': return 'premiere.png';
                 case 'ウォーターサーバー': return 'server.png';
                default: return 'placeholder.png';
            }
        }
    </script>
</body>
</html>
